{% extends '@SonataAdmin/standard_layout.html.twig' %}

{% block stylesheets %}
{{parent()}}
<link rel="stylesheet" href="{{asset('css/create.css')}}">
{% endblock %}

{% block sonata_head_title %}
    Crear Persona
{% endblock %}

{% block sonata_nav%}
    <nav class="navbar navbar-static-top" role="navigation">
        <a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button" title="Toggle Navigation">
        <span class="sr-only">Toggle Navigation</span>
        </a>
        <div class="navbar-left">
            <div class="hidden-xs">
                <ol class="nav navbar-top-links breadcrumb">
                    <li>
                        <a href={{path('sonata_admin_dashboard')}}>
                            <i class="fa fa-home"></i>
                        </a>
                    </li>
                    <li class="active">
                        <span style="display: inline-block;">Persona</span>
                    </li>
                </ol>
            </div>
        </div>
    </nav>
{% endblock sonata_nav %}

{% block sonata_admin_content %}
    {{form(form)}}
    {% if results is defined %}
    <div class="results">
        {% for data in results %}
        {% set i = loop.index0 %}
        <div id="result{{i}}" class="panel panel-primary">
            <div class="panel-heading">{{data.nombre}}</div>
            <div class="result panel-body">
                Legajo: {{data.legajo}}<br>
                <button target='{{data|json_encode|raw}}' class="addPersona btn btn-primary">Agregar</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
{% endblock %}

{% block javascripts %}
{{parent()}}

<script type="text/javascript">

$(document).ready(function(){
    $('.addPersona').off().on('click', function(){
        let button = $(this);
        let datos = JSON.parse($(this).attr('target'));
        let route = '{{ path('api_personas_post_collection') }}';
        //let content = $('#result' + target);
        console.log(datos.legajo);
        console.log($(this).attr('target'))
        //{"nombre":"Carlos H\u00e9ctor Daniel","legajo":2011}

        let postData = '{"idMapuche": ' + datos.legajo.toString() + '}';

        console.log(datos);
        $.ajax({
          method: "POST",
          url: route,
          data: postData,
          contentType: "application/ld+json",
        })
          .done(function() {
            button.parent().append('<i class="fa fa-check" aria-hidden="true" style="color: green"></i>');
          });


    });
});



</script>

{% endblock %}
